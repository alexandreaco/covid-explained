<template>
<div class="home">

  <svg class="float-right q-graphic" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="458.3436px" height="458.3436px" viewBox="0 0 458.3436 458.3436" style="enable-background:new 0 0 458.3436 458.3436;"
	 xml:space="preserve">
<defs>
</defs>
<g>
	<path style="fill:#DD694A;" d="M279.196,249.4017c7.651-7.1294,17.5627-9.7375,17.5627-20.345
		c0-8.1726-6.4336-13.0425-14.7805-13.0425c-10.4345,0-17.5639,6.7821-17.5639,17.9113h-27.9961
		c0.5216-24.5191,17.737-41.3871,46.7775-41.3871c25.9096,0,43.2993,14.4343,43.2993,35.4752
		c0,16.3453-8.6954,23.1273-16.3464,28.1703c-7.3037,4.6956-11.8251,7.1294-14.6074,10.4333
		c-2.4338,3.1308-3.3039,6.2605-3.3039,11.825h-25.0407C267.1967,260.7051,270.8491,256.358,279.196,249.4017z M264.4144,289.9198
		h29.7363v29.2136h-29.7363V289.9198z"/>
</g>
<g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="0.3536" y1="195.7733" x2="262.5703" y2="457.9901"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="8.1703" y1="187.9565" x2="270.3871" y2="450.1732"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="15.9871" y1="180.1397" x2="278.2039" y2="442.3565"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="23.8039" y1="172.3229" x2="286.0207" y2="434.5397"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="31.6207" y1="164.5061" x2="293.8375" y2="426.7229"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="39.4375" y1="156.6893" x2="301.6542" y2="418.9061"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="47.2543" y1="148.8726" x2="309.471" y2="411.0893"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="55.0711" y1="141.0558" x2="317.2878" y2="403.2725"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="62.8879" y1="133.239" x2="325.1046" y2="395.4557"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="70.7047" y1="125.4222" x2="332.9214" y2="387.6389"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="78.5215" y1="117.6054" x2="340.7382" y2="379.8221"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="86.3382" y1="109.7886" x2="348.555" y2="372.0053"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="94.155" y1="101.9718" x2="356.3718" y2="364.1886"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="101.9718" y1="94.155" x2="364.1886" y2="356.3718"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="109.7886" y1="86.3382" x2="372.0053" y2="348.555"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="117.6054" y1="78.5215" x2="379.8221" y2="340.7382"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="125.4222" y1="70.7047" x2="387.6389" y2="332.9214"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="133.239" y1="62.8879" x2="395.4557" y2="325.1046"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="141.0558" y1="55.0711" x2="403.2725" y2="317.2878"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="148.8726" y1="47.2543" x2="411.0893" y2="309.471"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="156.6893" y1="39.4375" x2="418.9061" y2="301.6542"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="164.5061" y1="31.6207" x2="426.7229" y2="293.8375"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="172.3229" y1="23.8039" x2="434.5397" y2="286.0207"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="180.1397" y1="15.9871" x2="442.3565" y2="278.2039"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="187.9565" y1="8.1703" x2="450.1732" y2="270.3871"/>
	</g>
	<g>
		<line style="fill:none;stroke:#33322D;stroke-miterlimit:10;" x1="195.7733" y1="0.3536" x2="457.9901" y2="262.5703"/>
	</g>
</g>
<g>
	<path style="fill:none;stroke:#DD694A;stroke-miterlimit:10;" d="M157.4057,202.162c3.8255-3.5647,8.7814-4.8687,8.7814-10.1725
		c0-4.0863-3.2168-6.5213-7.3902-6.5213c-5.2172,0-8.782,3.391-8.782,8.9556h-13.998c0.2608-12.2596,8.8685-20.6936,23.3887-20.6936
		c12.9548,0,21.6497,7.2171,21.6497,17.7376c0,8.1726-4.3477,11.5637-8.1732,14.0852c-3.6518,2.3478-5.9125,3.5647-7.3037,5.2167
		c-1.2169,1.5654-1.652,3.1302-1.652,5.9125h-12.5203C151.4061,207.8137,153.2323,205.6402,157.4057,202.162z M150.0149,222.4211
		h14.8682v14.6068h-14.8682V222.4211z"/>
</g>
<circle style="fill:none;stroke:#DD694A;stroke-miterlimit:10;" cx="229.1718" cy="229.1718" r="171.8728"/>
<g>
	<path style="fill:none;stroke:#DD694A;stroke-miterlimit:10;" d="M201.3138,64.3502c7.651-7.1294,17.5627-9.7375,17.5627-20.3451
		c0-8.1726-6.4335-13.0425-14.7805-13.0425c-10.4345,0-17.5639,6.7821-17.5639,17.9113h-27.9961
		c0.5216-24.5191,17.737-41.3871,46.7775-41.3871c25.9097,0,43.2993,14.4343,43.2993,35.4752
		c0,16.3453-8.6954,23.1274-16.3465,28.1703c-7.3037,4.6956-11.8251,7.1294-14.6074,10.4333
		c-2.4338,3.1308-3.3039,6.2605-3.3039,11.8251h-25.0407C189.3145,75.6537,192.9669,71.3065,201.3138,64.3502z M186.5322,104.8684
		h29.7363v29.2136h-29.7363V104.8684z"/>
</g>
<g>
	<path style="fill:#DD694A;" d="M329.2888,108.9107c5.7383-5.3471,13.1721-7.3031,13.1721-15.2588
		c0-6.1295-4.8252-9.7819-11.0854-9.7819c-7.8259,0-13.1729,5.0866-13.1729,13.4335h-20.997
		c0.3912-18.3893,13.3027-31.0404,35.0831-31.0404c19.4322,0,32.4745,10.8257,32.4745,26.6064
		c0,12.259-6.5216,17.3455-12.2599,21.1278c-5.4778,3.5217-8.8688,5.3471-10.9555,7.825c-1.8253,2.3481-2.4779,4.6954-2.4779,8.8688
		h-18.7805C320.2893,117.3883,323.0286,114.1279,329.2888,108.9107z M318.2026,139.2993h22.3022v21.9102h-22.3022V139.2993z"/>
</g>
<g>
	<path style="fill:#DD694A;" d="M76.3197,157.6015c5.7383-5.3471,13.1721-7.3031,13.1721-15.2588
		c0-6.1295-4.8252-9.7819-11.0853-9.7819c-7.8259,0-13.1729,5.0866-13.1729,13.4335H44.2365
		c0.3912-18.3893,13.3028-31.0404,35.0831-31.0404c19.4322,0,32.4745,10.8257,32.4745,26.6064
		c0,12.259-6.5216,17.3455-12.2598,21.1278c-5.4778,3.5217-8.8688,5.3471-10.9555,7.825c-1.8253,2.3481-2.4779,4.6953-2.4779,8.8688
		H67.3202C67.3202,166.0791,70.0596,162.8188,76.3197,157.6015z M65.2335,187.9902h22.3022v21.9102H65.2335V187.9902z"/>
</g>
<g>
	<path style="fill:#DD694A;" d="M117.5685,302.6992c7.651-7.1294,17.5627-9.7375,17.5627-20.3451
		c0-8.1726-6.4335-13.0425-14.7804-13.0425c-10.4345,0-17.5639,6.7821-17.5639,17.9113H74.7907
		c0.5216-24.5191,17.737-41.3871,46.7775-41.3871c25.9097,0,43.2993,14.4343,43.2993,35.4752
		c0,16.3453-8.6954,23.1273-16.3465,28.1703c-7.3037,4.6956-11.8251,7.1294-14.6074,10.4333
		c-2.4338,3.1308-3.3039,6.2605-3.3039,11.8251h-25.0407C105.5691,314.0027,109.2215,309.6556,117.5685,302.6992z
		 M102.7868,343.2174h29.7363v29.2136h-29.7363V343.2174z"/>
</g>
<g>
	<path style="fill:none;stroke:#DD694A;stroke-miterlimit:10;" d="M251.8613,371.0066c3.8255-3.5647,8.7814-4.8687,8.7814-10.1725
		c0-4.0863-3.2168-6.5213-7.3902-6.5213c-5.2172,0-8.782,3.3911-8.782,8.9556h-13.998
		c0.2608-12.2595,8.8685-20.6935,23.3887-20.6935c12.9548,0,21.6496,7.2171,21.6496,17.7376c0,8.1726-4.3477,11.5637-8.1732,14.0852
		c-3.6518,2.3478-5.9125,3.5647-7.3037,5.2167c-1.2169,1.5654-1.6519,3.1302-1.6519,5.9125h-12.5204
		C245.8616,376.6584,247.6879,374.4848,251.8613,371.0066z M244.4705,391.2657h14.8682v14.6068h-14.8682V391.2657z"/>
</g>
<g>
	<path style="fill:#DD694A;" d="M347.8839,322.9583c3.8255-3.5647,8.7814-4.8687,8.7814-10.1725
		c0-4.0863-3.2168-6.5213-7.3902-6.5213c-5.2172,0-8.782,3.391-8.782,8.9556h-13.998c0.2608-12.2596,8.8685-20.6936,23.3888-20.6936
		c12.9548,0,21.6496,7.2171,21.6496,17.7376c0,8.1726-4.3477,11.5637-8.1732,14.0851c-3.6518,2.3478-5.9125,3.5647-7.3037,5.2167
		c-1.2169,1.5654-1.6519,3.1302-1.6519,5.9125h-12.5204C341.8843,328.6101,343.7105,326.4365,347.8839,322.9583z M340.4931,343.2174
		h14.8682v14.6068h-14.8682V343.2174z"/>
</g>
<g>
	<path style="fill:none;stroke:#DD694A;stroke-miterlimit:10;" d="M381.2505,222.5076c3.8255-3.5647,8.7814-4.8687,8.7814-10.1725
		c0-4.0863-3.2168-6.5213-7.3902-6.5213c-5.2173,0-8.782,3.391-8.782,8.9556h-13.998c0.2608-12.2595,8.8685-20.6936,23.3887-20.6936
		c12.9548,0,21.6497,7.2171,21.6497,17.7376c0,8.1726-4.3477,11.5637-8.1732,14.0852c-3.6519,2.3478-5.9125,3.5647-7.3037,5.2167
		c-1.2169,1.5654-1.652,3.1302-1.652,5.9125h-12.5203C375.2508,228.1594,377.077,225.9858,381.2505,222.5076z M373.8596,242.7667
		h14.8682v14.6068h-14.8682V242.7667z"/>
</g>
</svg>


  <div class="preamble">



    <p class="lead">
      <strong>COVID-19 is confusing.</strong>  There's a lot of conflicting information out thereâ€”
      <a href="#" class="questionlink">can you get the virus from food?</a>
      <a href="#" class="questionlink">Is there such a thing as immunity?</a>
      <a href="#" class="questionlink">What kind of tests are really out there?</a>
      <a href="#" class="questionlink">Who is most at risk?</a> And all the conflicting information can make it hard to make
      decisions, from whether to go to the grocery store to when to send your kids back to day care.
    </p>
    <p>
      We are a team of researchers and students at Brown, MIT, Harvard, Mass General and elsewhere.
      <br /><em>We care about getting information
        out there.</em> <br />

      <strong>Emily Oster</strong> is an American economist, professor at Brown Univeristy, and bestselling author.<br />
      <strong>Galit Alter</strong> is a Professor of Medicine at Harvard Medical School and a Group Leader at the Ragon Institute
      of MGH, MIT and Harvard.
    </p>
    <p>
      Wondering where to start? Try one of our
      <router-link class="explainerlink" :to="{ name: 'Topic', params: { topicName: 'explainers' } }">explainers</router-link> on testing, or the path of the virus. Or check out our
      <router-link class="defintionlink" :to="{ name: 'Topic', params: { topicName: 'definitions' } }">definitions,</router-link> or
      <router-link class="questionlink" :to="{ name: 'Topic', params: { topicName: 'questions' } }">questions</router-link>. Or find out more
      <router-link :to="{ name: 'AboutUs' }">about our team,</router-link> and
      <router-link :to="{ name: 'ContactUs' }">contact us</router-link> with ideas!
    </p>
  </div>
  <div class="search-bar">
    <input type="text" v-model="searchTerm" placeholder="Search" />
  </div>

  <div class="block md:flex">

    <div class="w-full md:w-1/2 mr-2">
      <p class="py-6"><span class="explainers bullet"></span> The Science</p>
      <div class="post-card-container">
        <!-- <div class="card post-card" v-bind:class="post.topic" v-for="post in filteredExplainerPosts.slice(0, 3)"> -->
        <div class="card post-card" v-bind:class="post.topic" v-for="(post, i) in filteredExplainerPosts" :key="i">

          <i v-if="admin" class="material-icons edit" @click="redirectToEditPost(post.id)">edit</i>

          <router-link :to="{ name: 'Post', params: { postId: post.id } }">
            <div class="card-content">
              <span class="card-title">{{ post.title }}</span>
              <p class="text-snippet" v-if="post.subtitle">{{ post.subtitle }}</p>
              <p class="text-snippet" v-else>{{ post.text | createSnippet }}</p>
            </div>
          </router-link>
        </div>
      </div>
    </div>
    <div class="w-full md:w-1/2">

      <p class="py-6"><span class="questions bullet"></span> Your Questions</p>

      <div class="post-card-container">
        <div class="card post-card" v-bind:class="post.topic" v-for="(post, i) in filteredQuestionPosts" :key="i">
          <i v-if="admin" class="material-icons edit" @click="redirectToEditPost(post.id)">edit</i>

          <router-link :to="{ name: 'Post', params: { postId: post.id } }">
            <div class="card-content">
              <span class="card-title">{{ post.title }}</span>

            </div>
          </router-link>
        </div>
      </div>
    </div>
  </div>

</div>
</template>

<script>
import db from '@/firebase/init'
import firebase from 'firebase'
export default {
  name: 'Home',
  data() {
    return {
      posts: null,
      searchTerm: '',
      admin: null
    }
  },
  computed: {
    filteredPosts: function() {
      let postsFilteredByTitle = this.posts.filter(post => {
        return post.title.toLowerCase().match(this.searchTerm.toLowerCase())
      })
      let postsFilteredByContent = this.posts.filter(post => {
        return post.text.toLowerCase().match(this.searchTerm.toLowerCase())
      })
      let combinedArr = postsFilteredByTitle.concat(postsFilteredByContent)
      let deduplicatedArr = this.deduplicateById(combinedArr)
      return deduplicatedArr
    },
    filteredExplainerPosts: function() {
      return this.filteredPosts.filter(post => post.topic === 'explainers')
    },
    filteredDefintionsPosts: function() {
      return this.filteredPosts.filter(post => post.topic === 'definitions')
    },
    filteredQuestionPosts: function() {
      return this.filteredPosts.filter(post => post.topic === 'questions')
    }
  },
  methods: {
    deduplicateById(arr) {
      var obj = {}
      var stop = arr.length
      for (var i = 0, len = stop; i < len; i++) {
        obj[arr[i]['id']] = arr[i]
      }
      let arr2 = new Array()
      for (var key in obj) {
        if (key !== 'undefined') {
          arr2.push(obj[key])
        }
      }
      return arr2
    },
    redirectToEditPost(postId) {
      this.$router.push({
        name: 'EditPost',
        params: {
          postId: postId
        }
      })
    },
    getPosts() {
      if (this.posts === null) {
        this.posts = []
      }
      db.collection('posts')
        .get()
        .then(snapshot => {
          snapshot.forEach(doc => {
            let post = doc.data()
            post.id = doc.id
            this.posts.push(post)
          })
        })
    },
    setAdminIfLoggedIn() {
      let admin = firebase.auth().currentUser
      firebase.auth().onAuthStateChanged(admin => {
        if (admin) {
          this.admin = admin
        } else {
          this.admin = null
        }
      })
    }
  },

  filters: {
    createSnippet: function(value) {
      if (!value) {
        value = ''
      } else if (value.length > 50) {
        value = value.substring(0, 50) + '...'
      }
      return value
    }
  },
  created() {
    this.getPosts()
    this.setAdminIfLoggedIn()
  }
}
</script>


<style scoped>
.home {
  padding: 0 20px;
}

.post-card-container {}

.edit {
  position: absolute;
  top: 4px;
  right: 4px;
}

.edit:hover {
  opacity: 0.5;
  cursor: pointer;
}

.preamble {
  max-width: 1280px;
  font-weight: 100;

  padding: 1rem 0 2rem 0;
}

.preamble p {
  margin: 1rem 0;
  font-size: 20px;
}

.preamble img {
  width: 30px;
  height: 30px;
  border: 100%;
  display: inline-block;
}

.preamble .lead {
  font-size: 32px;
}

.preamble a {
  text-decoration: underline;
  text-decoration-style: solid;
}

a.questionlink {
  text-decoration-color: #dd694a;
}

a.defintionlink {
  text-decoration-color: #6c446d;
}

a.explainerlink {
  text-decoration-color: #197278;
}


.search-bar {
  position: sticky;
  z-index: 5;
  top: 80px;
}

.search-bar input {
  width: 100%;
}

.card-topic {
  font-size: 11px;
}

.card-title {
  font-size: 32px;
  line-height: 32px;
  padding: 10px 0;
  font-weight: 100;
}

.q-graphic {
  width: 350px;
  height: auto;
}

.card-content {
  display: flex;
  flex-direction: column;
  justify-content: space-around;
}

.text-author {
  font-size: 11px;
  padding: 0.5rem 0;
}

.text-snippet {
  font-size: 18px;
  line-height: 24px;
}


.post-card.explainers{
  text-decoration: none;
}
.post-card.explainers   .card-title {
  text-decoration: underline;
  text-decoration-color: #197278;
}
  .post-card.explainers .text-snippet {
  text-decoration: none;
}
</style>
